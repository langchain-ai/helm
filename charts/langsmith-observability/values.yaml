releaseName: "langsmith-observability"
langsmithNamespace: "romain"
langSmithReleaseName: "langsmith"

config:
  logs:
    enabled: true
  metrics:
    enabled: true
  traces:
    enabled: true

grafana:
  datasources:
    datasources.yaml:
      apiVersion: 1
      datasources:
        - name: Loki
          uid: loki
          type: loki
          url: http://{{ .Release.Name }}-loki-gateway
          isDefault: false
        - name: Mimir
          uid: prom
          type: prometheus
          url: http://{{ .Release.Name }}-mimir-nginx/prometheus
        - name: Tempo
          uid: tempo
          type: tempo
          url: http://{{ .Release.Name }}-tempo-query-frontend-discovery:3200
          isDefault: false
          jsonData:
            tracesToLogsV2:
              datasourceUid: loki
            lokiSearch:
              datasourceUid: loki
            tracesToMetrics:
              datasourceUid: prom
            serviceMap:
              datasourceUid: prom

loki:
  deploymentMode: Distributed
  loki:
    auth_enabled: false # This just drops tenant based authentication header, and all logs are under tenant "fake"
    schemaConfig:
      configs:
        - from: "2024-04-01"
          store: tsdb
          object_store: s3
          schema: v13
          index:
            prefix: loki_index_
            period: 24h

    storage_config:
      aws:
        region: us-east-1
        bucketnames: loki-chunks
        s3forcepathstyle: true

    storage:
      type: s3
      bucketNames:
        chunks: loki-chunks
        # In the future, configure a ruler bucket if we want to set rules/alerts on logs?
      s3:
        endpoint: langsmith-observability-minio.romain-observability.svc.cluster.local:9000
        region: us-east-1
        secretAccessKey: admin_password
        accessKeyId: admin
        insecure: true
        s3ForcePathStyle: true

    ingester:
      chunk_encoding: snappy
      max_chunk_age: 10s
    querier:
      # Default is 4, if you have enough memory and CPU you can increase, reduce if OOMing
      max_concurrent: 4
  
  lokiCanary: # Disable as it runs as a daemonset. This is only used to periodically test that Loki is working. Log volume can also tell.
    enabled: false
  test:
    enabled: false

  ingester:
    replicas: 3
  querier:
    replicas: 3
    maxUnavailable: 2
  queryFrontend:
    replicas: 2
    maxUnavailable: 1
  queryScheduler:
    replicas: 2
  distributor:
    replicas: 3
    maxUnavailable: 2
  compactor:
    replicas: 1
  indexGateway:
    replicas: 2
    maxUnavailable: 1

  # optional experimental components
  bloomPlanner:
    replicas: 0
  bloomBuilder:
    replicas: 0
  bloomGateway:
    replicas: 0

  # Zero out replica counts of other deployment modes
  backend:
    replicas: 0
  read:
    replicas: 0
  write:
    replicas: 0

  singleBinary:
    replicas: 0

mimir:
  minio:
    enabled: false
  mimir:
    structuredConfig:
      common:
         storage:
          backend: s3
          s3:
            endpoint: langsmith-observability-minio.romain-observability.svc.cluster.local:9000
            region: us-east-1
            secret_access_key: admin_password
            access_key_id: admin
            insecure: true

      blocks_storage:
        s3:
          bucket_name: mimir-blocks

      alertmanager_storage:
        s3:
          bucket_name: mimir-alertmanager

      ruler_storage:
        s3:
          bucket_name: mimir-ruler

minio:
  enabled: true
  mode: standalone
  replicas: 1
  persistence:
    enabled: true
    size: 10Gi
  readinessProbe:
    enabled: false
  auth:
    rootUser: "admin"
    rootPassword: "admin_password"
  defaultBuckets: "loki-chunks, mimir-blocks, mimir-ruler, mimir-alertmanager, tempo"

opentelemetryCollector:
  name: "langsmith-collector"
  image:
    repository: otel/opentelemetry-collector-contrib
    tag: "0.123.0"
  
  serviceAccounts:
    - "langsmith-ace-backend"
    - "langsmith-backend"
    - "langsmith-clickhouse"
    - "langsmith-frontend"
    - "langsmith-platform-backend"
    - "langsmith-playground"
    - "langsmith-postgres"
    - "langsmith-queue"
    - "langsmith-redis"

  metrics:
    langsmith:
      enabled: true
    redis:
      enabled: true
      serviceName: ""
      portName: ""
    postgres:
      enabled: true
      serviceName: ""
      portName: ""
    clickhouse:
      enabled: true
      serviceName: ""
      portName: ""

tempo:
  storage:
    trace:
      backend: s3
      s3:
        access_key: admin
        secret_key: admin_password
        bucket: tempo
        endpoint: langsmith-observability-minio.romain-observability.svc.cluster.local:9000
        insecure: true
  # Specifies which trace protocols to accept by the gateway.
  traces:
    otlp:
      grpc:
        enabled: true
      http:
        enabled: true
    zipkin:
      enabled: false
    jaeger:
      thriftHttp:
        enabled: false
    opencensus:
      enabled: false
  
  metricsGenerator:
    enabled: true

